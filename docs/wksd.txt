WKB Script Documentation
------------------------------------------------------------------------------

Classes at root (no parents):
 Objects (specified later)
 LINK_GAME_SET "anotherfile.cpp" (works like #include "header file")
 ObjectName_EXTENSION
 VERSION    |
 NAME       +-----> File information
 CREATED_BY |
 FILE_TYPE  |
 ASSOCIATE_CATEGORY
 DECLARE_ALIAS
 DECLARE_ITEM
 DEFINE_VALUE "DefValueName" float
 VALUE_TAG "ValueTag"
 DEFAULT_VALUE_TAG_INTERPRETATION "ValueTag" VALUE (Value tag interpreted as..., a macro?)
 EQUATION
 CONDITION (see Misc.cpp)
 REACTION (like ACTION_SEQUENCE but beginning with TRIGGERED_BY "TriggerName")
 ACTION_SEQUENCE
 OBJECT_FINDER_DEFINITION
 OBJECT_CREATION
 COMMAND
 ORDER
 ORDER_ASSIGNMENT
 TASK
 GAME_EVENT "EventName"
 ANIMATION_TAG "AnimName"
 ANIMATION_CAN_BE_INTERRUPTED "AnimName"
 SPECIAL_EFFECT_TAG "SFXName"
 GLOBAL_SPECIAL_EFFECT_MAPPING "SFXName" "DefaultFile.ANIM3"
 APPEARANCE_TAG "AppearName"
 SOUND_TAG "SndName"
 GLOBAL_MAP_SOUND_TAG "SndName" 1 NEAR "SndFile.wav"
 MUSIC_TAG (Used?)
 DECLARE_INTENSITY_MAP_TAG "IntMapTagName"
 TASK_CATEGORY "TaskCategoryName"
 ORDER_CATEGORY "OrderName" (same names used with ORDER)
 INDICATOR_TAG "IndicatorName"
 DIPLOMATIC_LADDER
 DEFAULT_DIPLOMATIC_STATUS "DiplomaticStatus"
 TRIBUTES
 DECLARE_CHAT_PERSONALITY "Arrogant"
 DECLARE_CHAT_DISPLAY "Ask for a gift"
 DECLARE_ATTACHMENT_POINT_TYPE "PP_" (see Miscellaneous.cpp)
 TERRAIN_ZONE "TerrainName" (see Miscellaneous.cpp)
 PACKAGE_RECEIPT_TRIGGER (see Miscellaneous.cpp)
 COST_FROM_GLOBAL_STOCKS (see Miscellaneous.cpp)
 AMBIENT_SOUND_LOWER_BOUND float (see "multi-player extensions.cpp")
 AMBIENT_SOUND_UPPER_BOUND float (")

Types of objects:
 - USER
 - LANDSCAPE
 - PLAYER
 - ARMY
 - TOWN
 - BUILDING_MARKER
 - CITY
 - MARKER
 - FORMATION
 - CONTAINER
 - PROP
 - BUILDING
 - CHARACTER
 - MISSILE

An object in a saved game has:
 POSITION
 ORIENTATION
 ITEM-s
 ASSOCIATE-s
 SUBTYPE
 INDIVIDUAL_REACTION-s
 ALIAS-es

 ORDER_CONFIGURATION		CHARACTER
 ATTACHMENT_REFERENCES		CHARACTER
 NAME				PLAYER, LEVEL
 MAP				LANDSCAPE
 COLOUR_INDEX			PLAYER
 START_CAMERA_POS		PLAYER
 START_CAMERA_ORIENTATION	PLAYER
 RECONNAISSANCE			PLAYER
 FOG_OF_WAR			PLAYER
 DIPLOMATIC_STATUS_BETWEEN	LEVEL

Object Definition:
 MAP_SOUND_TAG "SndName" 1 NEAR "SndFile.wav"
 MAP_SOUND_TAG_TO "SndName" 1 NEAR "?" (see Missiles\Greek Fire Trebuchet Ball\Greek Fire Trebuchet Ball.cpp)
 MAP_MUSIC_TAG "MusicName" "MusicFile.mp2"
 MAP_SPECIAL_EFFECT_TAG "SFXName" "File.ANIM3"
 MAP_TYPE_TAG "VersionName" BLUEPRINT (ex.: MAP_TYPE_TAG "Corpse Version" CHARACTER "Dead Scout")
 OBJECT_IS_RENDERABLE 0/1
 OBJECT_IS_SELECTABLE 0/1
 OBJECT_IS_TARGETABLE 0/1
 COLLIDABLE 0/1
 BOUNDING_VOLUME (example: BOUNDING_VOLUME SPHERE 0.5)
 MISSILE_SPEED VALUE
 LEAD_ACCURACY VALUE
 SPATIAL_INACCURACY VALUE
 INTRINSIC_REACTION "Reaction"
 DO_NOT_COLLIDE_WITH VALUE #7498
 STRIKE_FLOOR_SOUND "SndName"		|
 STRIKE_FLOOR_SPECIAL_EFFECT "SFXName"	|---> [MISSILE]
 STRIKE_WATER_SOUND "SndName"		|
 STRIKE_WATER_SPECIAL_EFFECT "SFXName"	|
 SCALE_APPEARANCE float float float (2 times in Missiles\Rocket\Rocket.cpp)
 PERPENDICULAR_TO_LANDSCAPE 0/1 (Dead Scout)
 DISPLAY_ON_MINIMAP 0/1
 DISPLAY_TOOL_TIP 0/1
 CAN_BE_BUILT_UPON 0/1
 PHYSICAL_SUBTYPE "Default"/"SubtypeName" ("Directory" (optional))
   APPEARANCE "Appear1"
     LOAD_ANIMATIONS_FROM "AnimDirectory\Anim1\"
     LOAD_ANIMATIONS_FROM "AnimDirectory\Anim2\" OVERRIDE (gives privilege over previous animations)
   END_APPEARANCE
   // Other appearances...
 AVAILABLE_FOR_STAMPDOWN 0/1
 INTERPRET_VALUE_TAG_AS "ValueTag" VALUE
 OFFERS_COMMAND "CmdName"
 DEFAULT_ATTACK_COMMAND "CmdName" (Scout has def. attack cmd. "Attack")
 CAN_SPAWN "ObjName"
 STARTS_WITH_ITEM "ItemName" float
 DISPLAYS_ITEM "ItemName"
 GENERAL_PORTRAIT "Pic.tga" |--> [PLAYER]
 AI__SPAWN_LOCATION_SELECTOR FINDER (see Characters\Scout\Scout.cpp)
 HAS_DYNAMIC_SHADOW 0/1
 HAS_STATIC_SHADOW 0/1
 GRADIENT_EFFECT (see Characters\Scout\Scout.cpp, relation with movement?)
 MOVEMENT_SPEED_EQUATION "EquationName"
 WHEEL_ON_FACING float
 MINIMUM_TURN_RADIUS float
 IDEAL_TURN_RADIUS float
 MOVEMENT_BAND
   NATURAL_MOVEMENT_SPEED float
   PLAY_ANIMATION TAG "TagName"
 CAN_TRAVERSE "TerrainName"
 MAX_GRADIENT float
 REMOVE_WHEN_NOT_REFERENCED
 RECEIVE_SIGHT_RANGE_EVENTS
 SIGHT_RANGE_EQUATION
 DEFAULT_TO_NEUTRAL_PLAYER 0/1
 USE_PATHFINDING 0/1
 RANDOMIZE_STAMPDOWN_ORIENTATION
 VARY_X_SCALE float float (random scale from 1st float to 2nd float)
 VARY_Y_SCALE float float (")
 VARY_Z_SCALE float float (")
 INHERITS_FROM "ObjName"
 SCALE_HEALTH_INDICATOR_BY (check Peasant)
 FLOATS_ON_WATER
 HIDDEN_BY_FOG_OF_WAR
 LOW_PRIORITY_SELECTION
 DISPLAY_CATEGORY MILITARY/ALIGNMENT/ECONOMIC
 MINIMAP_DISPLAY_CATEGORY RESOURCE/MILITARY/ECONOMIC (more than one can be used?)
 IGNORE_ALL_MISSILE_COLLISION
 PREFERRED_SPACING int

Values:
 CONSTANT float
 EQUATION_RESULT "EquationName" <FINDER>
 ITEM_VALUE "ItemName" <FINDER>
 BLUEPRINT_ITEM_VALUE "ItemName" BLUEPRINT
 OBJECT_TYPE (example: OBJECT_TYPE PLAYER "Neutral Player" FINDER_CANDIDATE)
 OBJECT_CLASS CHARACTER FINDER
 IS_IDLE <FINDER>
 IS_DISABLED
 IS_SUBSET_OF <FINDER>:a <FINDER>:b (a is in b?)
 MAP_WIDTH
 MAP_HEIGHT
 DIPLOMATIC_STATUS_AT_LEAST "DiplomaticStatus" FINDER FINDER (see Misc.cpp)
 VALUE_TAG_INTERPRETATION "ValueTag" FINDER
 DEFINED_VALUE "DefValueName"
 DISTANCE_BETWEEN HORIZONTAL/VERTICAL/3D FINDER FINDER
 NUM_OBJECTS FINDER
 CAN_REACH FINDER POSITION
 FINDER_RESULTS_COUNT <OBJECT_FINDER_DEFINITION> FINDER
 CURRENTLY_DOING_TASK "TaskCategory" FINDER
 CURRENTLY_DOING_ORDER "OrderCategory" FINDER
 BUILDING_TYPE GATEHOUSE/WALL_*/... FINDER
 HAS_APPEARANCE FINDER "AppearanceName"
 OBJECT_ID FINDER
 SAME_PLAYER FINDER:a FINDER:b (Players from B are in A?)
 INDEXED_ITEM_VALUE "ItemName" VALUE FINDER
 TILE_ITEM "ItemName" FINDER (get an item from the tile under the object)
 WATER_BENEATH FINDER (is the object over water? return 1 if yes else 0)
 AI_CONTROLLED

ENODES (those who aren't also VALUEs):
<ENODE_NAME> <number of ENODE children>
 IS_ZERO 1
 IS_POSITIVE 1
 IS_NEGATIVE 1
 ADDITION 2
 SUBTRACTION 2
 MULTIPLICATION 2
 DIVISION 2
 ABSOLUTE_VALUE 1
 MIN 2
 MAX 2
 AND 1
 OR 1
 NOT 1
 EQUALS 2
 LESS_THAN
 LESS_THAN_OR_EQUAL_TO 2
 GREATER_THAN 2
 GREATER_THAN_OR_EQUAL_TO 2
 RANDOM_UP_TO 1 (from ? to single ENODE)
 RANDOM_INTEGER 2 (from 1st ENODE inclusive to 2nd ENODE inclusive)
 RANDOM_RANGE 2 (from 1st ENODE exclusive to 2nd ENODE exclusive (between the 2 ENODEs))
 IF_THEN_ELSE 3 (if A then B else C)

Finders:
 FINDER_CREATOR <POSITION> (in OBJECT_CREATION)
 FINDER_LEVEL
 FINDER_PLAYER
 FINDER_PLAYERS "EquationName"
 FINDER_SELF
 FINDER_CONTROLLER (the parent, can be a player, a formation, ...)
 FINDER_TARGET (in COMMAND)
 FINDER_RESULTS <OBJECT_FINDER_DEFINITION>
 FINDER_CANDITATE (in FINDER_SUBORDINATES BY_EQUATION <equation> ...)
		  (also in EQUATION_RESULT, ex.: in "EQUATION_RESULT "e" FINDER_SELF, FINDER_CANDITATE is FINDER_SELF in the EQUATION)
		  (also in FINDERS_PLAYERS)
 FINDER_OBJECTS <FINDER>
 FINDER_SPECIFIC_ID int
 FINDER_REFERENCERS "TaskCategoryName"
 FINDER_ALIAS "AliasCat"
 FINDER_ASSOCIATES "AssoCat"
 FINDER_ASSOCIATORS "AssoCat"
 FINDER_DISABLED_ASSOCIATES "Garrison"
 FINDER_SEQUENCE_EXECUTOR
 FINDER_USER
 FINDER_ORDER_GIVER (the object who executed the ASSIGN_ORDER_VIA action)
 FINDER_PACKAGE_SENDER
 FINDER_METRE_RADIUS VALUE:radius FLAGS
   FLAGS:
	ALLIED_UNITS
	ENEMY_UNITS
	ORIGINAL_ENEMY_UNITS
	SAME_PLAYER_UNITS
	ORIGINAL_SAME_PLAYER_UNITS
	CHARACTERS_ONLY
	BUILINGS_ONLY
	CHARACTERS_AND_BUILDINGS_ONLY
   By default: all units from all players
 FINDER_DISCOVERED_UNITS FLAGS (same as from FINDER_METRE_RADIUS)

Those finders require one or more children (usually one) of FINDER type in the next lines:
 FINDER_UNION <num.children>
 FINDER_INTERSECTION <num.children>
 FINDER_CHAIN <num.children>
 FINDER_ALTERNATIVE <num.children> (if A doesn't have any object, look at B, ...)
 FINDER_SUBORDINATES (BY_EQUATION "Equation") (OF_CLASS CHARACTER) (BY_BLUEPRINT "Peasant")
   (You can use BY_EQUATION or BY_BLUEPRINT but not both.)
 FINDER_NEAREST_CANDIDATE (from FINDER_SELF?)
 FINDER_GRADE_SELECT BY_LOWEST/BY_HIGHEST "Equation" VALUE:numObjects
 FINDER_GRADE_SELECT_CANDIDATES BY_LOWEST/BY_HIGHEST VALUE:filter VALUE:numObjects (only in feature tests)
 FINDER_FILTER EQUATION (uses FINDER_CANDIDATE in the equation)
 FINDER_FILTER_FIRST EQUATION VALUE (first n=VALUE objects)
 FINDER_FILTER_CANDIDATES VALUE:filter FINDER:objs

Positions (XYZ and 2 components for orientation):
 (note: <BLUEPRINT> is like: BUILDING "Maypole")
 LOCATION_OF <FINDER>
 NEAREST_VALID_STAMPDOWN_POS <BLUEPRINT> <ANOTHER_POSITION>
   (<obj_type> (like BUILDING/CHARACTER/...) seems to be not required)
 NEAREST_VALID_POSITION_FOR
 OFFSET_FROM FINDER VALUE VALUE VALUE (Feature Tests.cpp @ line 4222)
 NEAREST_CONSTRUCTION_SITE <POSITION> <VALUE> <VALUE> <VALUE> (Feature Tests.cpp @ line 5645)
 IN_FRONT_OF <POSITION> <VALUE>
 CENTRE_OF_MAP
 OUT_AT_ANGLE FINDER VALUE:angle VALUE:radius
 ABSOLUTE_POSITION float float float float float
 MATCHING_OFFSET POSITION POSITION POSITION (use x from 1st pos, use y from 2nd, use z from 3rd)
 FIRING_ATTACHMENT_POINT
 THE_OTHER_SIDE_OF FINDER FINDER VALUE

Actions:
EXECUTE_SEQUENCE "ActionSequence" FINDER
EXECUTE_SEQUENCE_AFTER_DELAY "ActionSequence" FINDER VALUE
EXECUTE_SEQUENCE_OVER_PERIOD "ActionSequence" FINDER VALUE
REGISTER_ASSOCIATES FINDER "AssociateCategory" FINDER
DEREGISTER_ASSOCIATES FINDER "AssociateCategory" FINDER
CLEAR_ASSOCIATES "AssociateCategory" FINDER
ASSIGN_ORDER_VIA "OrderAssignment" FINDER
COPY_FACING_OF FINDER:dest FINDER:src (is this order correct?)
REMOVE FINDER
PLAY_SPECIAL_EFFECT "SFXName" FINDER POSITION
PLAY_SOUND "SoundName" FINDER FINDER
INCREASE_ITEM "ItemName" FINDER VALUE
DECREASE_ITEM "ItemName" FINDER VALUE
SET_ITEM "ItemName" FINDER VALUE
TRANSFER_CONTROL FINDER FINDER
CONVERT_TO BLUEPRINT FINDER
UPON_CONDITION VALUE
  ELSE			(if condition is zero)
 END_UPON_CONDITION	(the end)
ADD_REACTION "Reaction" FINDER
CREATE_OBJECT BLUEPRINT POSITION
CREATE_OBJECT_VIA "ObjectCreation" FINDER
SET_SELECTABLE 0/1 FINDER
SEND_EVENT "GameEvent" FINDER
TELEPORT FINDER POSITION
TERMINATE_ORDER FINDER
FLOODFILL_AREA_WITH BLUEPRINT POSITION CONSTANT
FLOODFILL_MAP_WITH BLUEPRINT
IDENTIFY_AND_MARK_CLUSTERS ?
TERMINATE FINDER
SET_INDEXED_ITEM "ItemName" VALUE FINDER VALUE
INCREASE_INDEXED_ITEM "ItemName" VALUE FINDER VALUE
DECREASE_INDEXED_ITEM "ItemName" VALUE FINDER VALUE
SWITCH_CONDITION VALUE
  CASE VALUE
    ACTION ...
    ...
  END_CASE
  CASE ...
  ...
 END_SWITCH_CONDITION
SWITCH_HIGHEST (go to highest case value)
  ... (see SWITCH_CONDITION)
END_SWITCH_HIGHEST
EXECUTE_ONE_AT_RANDOM
  ACTION ...
  ACTION ...
  ...
 END_EXECUTE_ONE_AT_RANDOM
ADOPT_APPEARANCE_FOR OBJTYPE "ObjName" "Subtype" "Appearance" FINDER
ADOPT_DEFAULT_APPEARANCE_FOR FINDER FINDER:[The player]
SWITCH_APPEARANCE "AppearanceTag" FINDER
SET_SCALE FINDER VALUE VALUE VALUE

SEND_CHAT_MESSAGE "Name" FINDER FINDER
MAKE_DIPLOMATIC_OFFER "DiplomaticStatus FINDER FINDER
CHANGE_DIPLOMATIC_STATUS FIDNER FINDER "DiplomaticStatus"
DECLINE_DIPLOMATIC_OFFER FINDER FINDER
MAKE_DIPLOMATIC_OFFER

TERMINATE_THIS_TASK (mainly used in tasks)

DIPLOMATIC_LADDER
	STATUS "Allied"
	STATUS "Neutral"
	STATUS "Enemy"
END_DIPLOMATIC_LADDER

TRIBUTES
	TRIBUTE_ITEM "Food"
	TRIBUTE_ITEM "Wood"
	TRIBUTE_ITEM "Gold"
END_TRIBUTES

CONDITION "ConditionName"
	TEST EQUATION
	HINT TextTagInLanguageDotTXT (VALUE VALUE VALUE ...)
		(VALUEs correspond to %d in the string)
END_CONDITION

OBJECT_CREATION "ObjCreationName"
	TYPE_TO_CREATE BLUEPRINT
	CONTROLLER FINDER (player)
	CREATE_AT POSITION
	POST_CREATION_SEQUENCE (optional)
		ACTION ... // FINDER_SELF is new object.
		...
	END_POST_CREATION_SEQUENCE
END_OBJECT_CREATION

TASK "TaskName"
	IN_TASK_CATEGORY "TaskCategoryName"

// "Creates a new trigger".
// No need to declare new trigger with GAME_EVENT.
PACKAGE_RECEIPT_TRIGGER "I Just Saw a Spy"
	TRIGGERED_BY "On Seeing Object"
	TRIGGERED_BY "Another trigger"
	...
	ASSESSMENT "Its a Spy" // an Equation which is one of the conditions to trigger.
		// The Equation or trigger "On Seeing Object" uses FINDER_PACKAGE_SENDER to get the concerned (seen) object.
	ASSESSMENT "Another condition"
	...
END_PACKAGE_RECEIPT_TRIGGER

TERRAIN "TerrainName"
	STARTS_WITH_ITEM "ItemName" VALUE	// Same items declared with DECLARE_ITEM
	STARTS_WITH_ITEM ...
	TERRAIN_COST 1.0			// The bigger the cheaper?
	ASSOCIATE_TILE_TEXTURE_GROUP "GRASS4"
	ASSOCIATE_TILE_TEXTURE_GROUP "GRASS1-GRASS4"
	...
END_TERRAIN

TERRAIN_BLUEPRINT_LIST "TerrainBlueprintList"
	USE_TERRAIN_BLUEPRINT "TerrainName"
	USE_TERRAIN_BLUEPRINT "AnotherOne"
	...
END_TERRAIN_BLUEPRINT_LIST

FOOTPRINT "FootprintName"
	ORIGIN float float
	MAX_FOUNDATION_HEIGHT_DIFFERENTIAL int
	WALL_ORIGIN_MIN TOP_LEFT/BOTTOM_RIGHT int int
	WALL_ORIGIN_DEFAULT " " "
	WALL_ORIGIN_MAX " " "
	TILE_OFFSET int int
		USE_TERRAIN_BLUEPRINT_LIST "TerrainBlueprintList"
		SET_PATHFINDING CANNOT_BE_CONSTRUCTED_UPON/BLOCKED/PASSABLE
		DEFORM_TERRAIN LEAVE_AS_IS
		WALL_GAP 1
	END_TILE_OFFSET
	TILE_OFFSET ...
	

---------------------------------------------------------

Tricks:
// If num. objs is not null.
ACTION UPON_CONDITION NUM_OBJECTS FINDER_RESULTS "All My Available And Used Trees"
ENODE NUM_OBJECTS FINDER_ASSOCIATES "My Available Trees"


Interesting:

Blueprint RESERVE_SPACE_FOR_CONSTRUCTION
ASSOCIATE_CATEGORY "Skirmish Marker" CUSTOM_COLOUR 0 255 0 (custom colors only seen with ASSOCIATE_CATEGORY)
FINDER_METRE_RADIUS CONSTANT 15 ALLIED_UNITS CHARACTERS_ONLY
IMMEDIATE_LEVEL

OBJECT_FINDER_DEFINITION "Shops Subordinate To My City"
	FINDER_SUBORDINATES BY_BLUEPRINT "Shop Stone" OF_CLASS BUILDING
		FINDER_SUBORDINATES OF_CLASS CITY
			FINDER_PLAYER
END_OBJECT_FINDER_DEFINITION
-
SHIT:
Get what the player has in possession including himself
	Extract cities and their objects included in them
		Extract "Shop Stone" buildings
-
BETTER:
Get subordinates (children) by blueprint "Shop Stone" and of type BUILDING from
	Get subordinates of type CITY from
		The player

VALUE or ENODE?:

NUM_ORDERS

OBJECT_FINDER_DEFINITION "Controller of Target"
	FINDER_CHAIN 2
		FINDER_TARGET
		FINDER_CONTROLLER
END_OBJECT_FINDER_DEFINITION

Subordinates are what I sometimes call "children" of an object (objects in objects).